<% breadcrumb @answer %>
<% meta_description "answer with #{@answer.replies.count} replies. It is about \"#{truncate @answer.body, 60}\"" %>

<%= render :partial => 'find_question' %>

  <div class="box-list two-col-big clear-block">
    <div class="clear-block">
      <div class="answer-header clear-block">
        <h2><%= @answer.closed? ? 'CLOSED' : 'OPEN' %> QUESTION</h2>
        <p class="abuse-link float-right">
          <%- if logged_in? && !@has_abuse -%> <!--XXX-->
						<%= report_abuse_link_to formatted_new_answer_abuse_path(@answer, 'html') %>
          <%- end -%>
        </p>
      </div>
      <div class="elements clear-block answer">
        <div class="thumb clear-block">
          <p><%= link_to avatar_image(@answer.user, :icon), user_path(@answer.user) %></p>
          <p class="name"><%= link_to @answer.user.login, user_path(@answer.user) %></p>
        </div>
        <div class="details">

          <% if current_user_answer_page? && @answer.editable? %>
						<span class="edit-command">
							<a href="#" onclick="Effect.BlindDown('edit-container');return false;">[edit]</a> <em>(for another <%= @answer.editable_for %>)</em>
						</span>
            <div id="edit-container" style="clear:both;display: none">
              <%- form_for(@answer) do |f| -%>
                <%= f.text_area :body, :value => @answer.body %><br />
                <%= image_submit_tag 'button_send.png' %>
              <%- end -%>                  
            </div>
          <% end %>

          <h1><%= @answer.body %></h1>

          <% unless @answer.closed? %>
            <div class="float-right">
              <%= link_to image_tag('button_reply.png'), '#',
                    :onclick => (logged_in? ? %[Effect.toggle('reply-form-container', 'slide'); return false] :
                                 %[Message.show('You have to login or sign up to reply', 'notice', true); return false])
              -%>
              </div>                
          <% end %>

					<div class="answer-show float-left">
						<%= rating(@answer, :class => 'float-left') %><div class="clearer"></div>
						<p class="abstract">posted <%= time_ago_in_words(@answer.created_at) %> ago</p>
					</div>

          <div id="reply-form-container" style="clear:both;display: none">
            <%- form_for(:reply, :url => answer_replies_path(@answer)) do |f| -%>
              <%= f.text_area :body %><br />
							<%= image_submit_tag 'button_send.png' %>
            <%- end -%>                  
          </div>
        </div>
      </div>
      
      <div class="answer-header clear-block">
        <h2>Replies <span>(<%= @answer.replies.count %>)</span></h2>
      </div>
      <%- @answer.replies.each do |reply| -%>
        <div class="elements clear-block reply">
          <div class="thumb clear-block">
            <p><%= link_to avatar_image(reply.user, :icon), user_path(reply.user) %></p>
            <p class="name"><%= link_to reply.user.login, user_path(reply.user) %></p>
          </div>
          <div class="details">
            <p class="body"><%= reply.body %></p>
            <%= rating(reply, :class => 'float-left') %><div class="clearer"></div>
            <p class="abstract float-left"><%= time_ago_in_words(reply.created_at) %> ago</p>
          </div>
        </div>
      <%- end -%>  
    </div>
  </div>

	<div class="box-list semi-one-col clear-block">
		<div class="azzurro-boxes" id="other_by_user">
			<%= render :partial => 'other_by_user' unless @other_answers_by_author.size.zero? %>
		</div>
  </div>  
  
	<% if @similar_answers.size > 1 %>
    <div id="similar-questions" class="box-list three-col clear-block clear-float">
			<div class="tabmenu">
				<div class="tab active" id="top-answers-tab">
					<div class="sx"> </div>
					<div class="rp">
						<p class="title blue-text">SIMILAR QUESTIONS</p>
						<p class="counter">(<%= @similar_answers.size - 1%>)</p>
					</div>
					<div class="dx"> </div>
				</div>    
			</div>

			<div class="clear-block similar answers">
				<%= render :partial => 'answer_medium', :collection => (@similar_answers - [@answer]) %>
			</div>
		</div>
	<% end %>
